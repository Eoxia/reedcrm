window.reedcrm||(window.reedcrm={},window.reedcrm.scriptsLoaded=!1),window.reedcrm.scriptsLoaded||(window.reedcrm.init=function(){window.reedcrm.load_list_script()},window.reedcrm.load_list_script=function(){if(!window.reedcrm.scriptsLoaded){let e=void 0,n=void 0;for(e in window.reedcrm)for(n in window.reedcrm[e].init&&window.reedcrm[e].init(),window.reedcrm[e])window.reedcrm[e]&&window.reedcrm[e][n]&&window.reedcrm[e][n].init&&window.reedcrm[e][n].init();window.reedcrm.scriptsLoaded=!0}},window.reedcrm.refresh=function(){let e=void 0,n=void 0;for(e in window.reedcrm)for(n in window.reedcrm[e].refresh&&window.reedcrm[e].refresh(),window.reedcrm[e])window.reedcrm[e]&&window.reedcrm[e][n]&&window.reedcrm[e][n].refresh&&window.reedcrm[e][n].refresh()},$(document).ready(window.reedcrm.init)),window.reedcrm.address={},window.reedcrm.address.init=function(){window.reedcrm.address.event()},window.reedcrm.address.event=function(){$(document).on("click",'[name="favorite_address"]',window.reedcrm.address.toggleAddressFavorite)},window.reedcrm.address.toggleAddressFavorite=function(){var e=$(this).attr("value");let n=$(this);var o=window.saturne.toolbox.getToken();let t="?";document.URL.match(/\?/)&&(t="&"),$.ajax({url:document.URL+t+"action=toggle_favorite&contact_id="+e+"&token="+o,type:"POST",processData:!1,contentType:!1,success:function(){var e=$(".fas.fa-star");n.hasClass("far")&&(n.removeClass("far"),n.addClass("fas")),e.removeClass("fas").addClass("far")},error:function(){}})},window.reedcrm||(window.reedcrm={}),window.reedcrm.callnotifications={},window.reedcrm.callnotifications.init=function(){console.log("ReedCRM Call Notifications initialized"),window.reedcrm.callnotifications.config(),window.reedcrm.callnotifications.start()},window.reedcrm.callnotifications.config=function(){var e=document.getElementById("reedcrm-call-config");e?(window.reedcrm.callnotifications.frequency=parseInt(e.dataset.frequency)||60,window.reedcrm.callnotifications.autoOpen=parseInt(e.dataset.autoOpen)||0,window.reedcrm.callnotifications.openNewTab=parseInt(e.dataset.openNewTab)||1,window.reedcrm.callnotifications.checkUrl=e.dataset.checkUrl||"",window.reedcrm.callnotifications.trans={incomingCall:e.dataset.transIncomingCall||"Incoming Call",from:e.dataset.transFrom||"From",phone:e.dataset.transPhone||"Phone",email:e.dataset.transEmail||"Email",viewContact:e.dataset.transViewContact||"View Contact"}):(window.reedcrm.callnotifications.frequency=60,window.reedcrm.callnotifications.autoOpen=0,window.reedcrm.callnotifications.openNewTab=1,window.reedcrm.callnotifications.checkUrl="",window.reedcrm.callnotifications.trans={incomingCall:"Incoming Call",from:"From",phone:"Phone",email:"Email",viewContact:"View Contact"}),window.reedcrm.callnotifications.enabled=!0,window.reedcrm.callnotifications.interval=null},window.reedcrm.callnotifications.start=function(){window.reedcrm.callnotifications.checkUrl?setTimeout(function(){console.log("Starting ReedCRM call check with frequency: "+window.reedcrm.callnotifications.frequency+"s"),window.reedcrm.callnotifications.check(),window.reedcrm.callnotifications.interval=setInterval(window.reedcrm.callnotifications.check,1e3*window.reedcrm.callnotifications.frequency)},3e3):console.error("ReedCRM: No check URL configured for call notifications")},window.reedcrm.callnotifications.check=function(){window.reedcrm.callnotifications.enabled&&jQuery.ajax({url:window.reedcrm.callnotifications.checkUrl,type:"GET",dataType:"json",success:function(e){e&&0<e.length&&(console.log("Found "+e.length+" new call events"),jQuery.each(e,function(e,n){window.reedcrm.callnotifications.show(n)}))},error:function(e,n,o){console.error("Error checking call events:",o)}})},window.reedcrm.callnotifications.show=function(n){console.log("Showing call notification:",n);var e=window.reedcrm.callnotifications.trans,o="<strong>"+e.incomingCall+"</strong> : "+n.contact_name;n.caller&&(o+="<br>"+e.from+": "+n.caller),n.contact_phone&&(o+="<br>"+e.phone+": "+n.contact_phone),n.contact_email&&(o+="<br>"+e.email+": "+n.contact_email),o=o+'<br><br><button type="button" class="button" onclick="window.open(\''+n.url+"', '_blank')\">"+e.viewContact+"</button>",jQuery.jnotify(o,"success",!0,{sticky:!0,timeout:3e4}),window.reedcrm.callnotifications.autoOpen&&setTimeout(function(){var e=window.reedcrm.callnotifications.openNewTab?"_blank":"_self";window.open(n.url,e)},1e3)},window.reedcrm.callnotifications.enable=function(){window.reedcrm.callnotifications.enabled=!0,window.reedcrm.callnotifications.check(),window.reedcrm.callnotifications.interval=setInterval(window.reedcrm.callnotifications.check,1e3*window.reedcrm.callnotifications.frequency),console.log("ReedCRM call notifications enabled")},window.reedcrm.callnotifications.disable=function(){window.reedcrm.callnotifications.enabled=!1,window.reedcrm.callnotifications.interval&&clearInterval(window.reedcrm.callnotifications.interval),console.log("ReedCRM call notifications disabled")},jQuery(document).ready(function(){window.reedcrm.callnotifications.init()}),window.reedcrm||(window.reedcrm={}),window.reedcrm.eventpro={},window.reedcrm.eventpro.modalId="eventproCardModal",window.reedcrm.eventpro.refreshTriggered=!1,window.reedcrm.eventpro.init=function(){window.reedcrm.eventpro.event(),window.reedcrm.eventpro.modalCloseWatcher(),window.reedcrm.eventpro.initAddContact(),window.reedcrm.eventpro.initRelaunchTooltips()},window.reedcrm.eventpro.injectIframeCSS=function(e){try{var n=e.contentDocument||e.contentWindow.document,o=n.getElementById("addeventform");if(o){Array.from(n.body.children).forEach(function(e){e.style.display="none"}),n.body.appendChild(o);for(var t=o.nextSibling;t;){var r=t,t=t.nextSibling;n.body.removeChild(r)}n.documentElement.classList.add("reedcrm-modal-iframe-html"),n.body.classList.add("reedcrm-modal-iframe-body"),o.classList.add("reedcrm-modal-iframe-form"),$(e).css("opacity","1"),void 0!==window.saturne&&window.saturne.loader?window.saturne.loader.remove($("#"+window.reedcrm.eventpro.modalId+"-loader")):$("#"+window.reedcrm.eventpro.modalId+"-loader").hide()}else console.log("addeventform not found")}catch(e){console.log("Could not inject CSS into iframe:",e)}},window.reedcrm.eventpro.refreshProjectRow=function(o){var e,t;o&&(e=window.location.href.split("&action=")[0].split("#")[0],(t=$('tr[data-rowid="'+o+'"]')).length)&&(t.css("opacity","0.5"),$.ajax({url:e,type:"GET",success:function(e){var n=$(e).find('tr[data-rowid="'+o+'"]');n.length&&t.length?t.fadeOut(200,function(){t.html(n.html()),t.css("opacity","1"),t.fadeIn(200)}):t.css("opacity","1")},error:function(){t.css("opacity","1")}}))},window.reedcrm.eventpro.modalCloseWatcher=function(){var n=!1;setInterval(function(){var e=$("#"+window.reedcrm.eventpro.modalId).hasClass("modal-active");n&&!e&&(window.reedcrm.eventpro.refreshTriggered=!1),n=e},200)},window.reedcrm.eventpro.event=function(){$(document).on("click",".reedcrm-modal-open",function(e){var n,t,o,r=$(this),i=r.attr("data-modal-url"),r=r.attr("data-project-id");i&&(n=$("#"+window.reedcrm.eventpro.modalId),t=$("#"+window.reedcrm.eventpro.modalId+"-iframe"),(o=$("#"+window.reedcrm.eventpro.modalId+"-loader")).show().addClass("wpeo-loader"),void 0!==window.saturne&&window.saturne.loader&&window.saturne.loader.display(o),n.addClass("modal-active"),t.css("opacity","0"),t.data("initial-url",i),t.data("project-id",r),t.data("loaded-once",!1),t.data("form-submitted",!1),t.off("load.reedcrm").on("load.reedcrm",function(){window.reedcrm.eventpro.injectIframeCSS(this);try{var e=this.contentDocument||this.contentWindow.document,n=(e.querySelectorAll("form").forEach(function(e){e.addEventListener("submit",function(){t.data("form-submitted",!0)},!0)}),e.querySelectorAll('a[href*="tab="]')),o=this;n.forEach(function(e){e.addEventListener("click",function(e){var n=$("#"+window.reedcrm.eventpro.modalId+"-loader");n.show().addClass("wpeo-loader"),void 0!==window.saturne&&window.saturne.loader&&window.saturne.loader.display(n),$(o).css("opacity","0")})}),window.reedcrm.eventpro.initAddContactInIframe(e,this)}catch(e){}}),t.off("load.reedcrm-submit").on("load.reedcrm-submit",function(){try{var e,n=t.data("loaded-once"),o=t.data("form-submitted");n&&o&&!window.reedcrm.eventpro.refreshTriggered&&(window.reedcrm.eventpro.refreshTriggered=!0,e=t.data("project-id"),setTimeout(function(){$("#"+window.reedcrm.eventpro.modalId).removeClass("modal-active"),window.reedcrm.eventpro.refreshProjectRow(e),t.data("form-submitted",!1)},300)),t.data("loaded-once",!0)}catch(e){}}),n.attr("data-project-id",r),setTimeout(function(){t.attr("src",i)},50))})},window.reedcrm.eventpro.initAddContact=function(){$(document).on("click",".reedcrm-add-contact-btn",function(e){e.preventDefault(),$(this).closest(".reedcrm-contact-field-wrapper").parent().find(".reedcrm-add-contact-form").slideDown()}),$(document).on("click",".reedcrm-add-contact-cancel",function(e){e.preventDefault();e=$(this).closest(".reedcrm-add-contact-form");e.slideUp(),e.find("input").val("")}),$(document).on("click",".reedcrm-add-contact-submit",function(e){e.preventDefault(),window.reedcrm.eventpro.submitAddContact($(this))})},window.reedcrm.eventpro.submitAddContact=function(e){var o=e.closest(".reedcrm-add-contact-form"),n=o.closest("form"),t=n.find('select[name="contactid"]'),r=n.find('select[name="socid"]').val(),i=o.find("#new_contact_lastname").val().trim();i?r?(n={action:"create_contact",token:n.find('input[name="token"]').val(),from_id:n.find('input[name="from_id"]').val(),from_type:n.find('input[name="from_type"]').val(),socid:r,new_contact_lastname:i,new_contact_firstname:o.find("#new_contact_firstname").val().trim(),new_contact_phone_pro:o.find("#new_contact_phone_pro").val().trim(),new_contact_email:o.find("#new_contact_email").val().trim()},e.prop("disabled",!0),r=window.location.href.split("?")[0],$.ajax({url:r,type:"POST",data:n,dataType:"json",success:function(e){var n;e&&e.success?(n=new Option(e.contact_label,e.contact_id,!0,!0),t.append(n).trigger("change"),o.slideUp(),o.find("input").val(""),void 0!==window.saturne&&window.saturne.notification&&window.saturne.notification.success("Contact créé avec succès")):(n=e&&e.error?e.error:"Erreur lors de la création du contact",void 0!==window.saturne&&window.saturne.notification&&window.saturne.notification.error(n))},error:function(e,n,o){console.error("AJAX Error:",e,n,o);var t,n="Erreur lors de la création du contact";try{e.responseText&&(t=JSON.parse(e.responseText)).error&&(n=t.error)}catch(e){console.error("Error parsing response:",e)}void 0!==window.saturne&&window.saturne.notification&&window.saturne.notification.error(n)},complete:function(){e.prop("disabled",!1)}})):void 0!==window.saturne&&window.saturne.notification&&window.saturne.notification.error("Veuillez sélectionner un tiers"):void 0!==window.saturne&&window.saturne.notification&&window.saturne.notification.error("Le nom est obligatoire")},window.reedcrm.eventpro.initAddContactInIframe=function(e,n){var c=e.defaultView||e.parentWindow,a=c.$||c.jQuery||$;a(e).on("click",".reedcrm-add-contact-btn",function(e){e.preventDefault(),a(this).closest(".reedcrm-contact-field-wrapper").parent().find(".reedcrm-add-contact-form").slideDown()}),a(e).on("click",".reedcrm-add-contact-cancel",function(e){e.preventDefault();e=a(this).closest(".reedcrm-add-contact-form");e.slideUp(),e.find("input").val("")}),a(e).on("click",".reedcrm-add-contact-submit",function(e){e.preventDefault();var n=a(this),o=n.closest(".reedcrm-add-contact-form"),e=n.closest("form"),t=e.find('select[name="contactid"]'),r=e.find('select[name="socid"]').val(),i=o.find("#new_contact_lastname").val().trim();i?r?(e={action:"create_contact",token:e.find('input[name="token"]').val(),from_id:e.find('input[name="from_id"]').val(),from_type:e.find('input[name="from_type"]').val(),socid:r,new_contact_lastname:i,new_contact_firstname:o.find("#new_contact_firstname").val().trim(),new_contact_phone_pro:o.find("#new_contact_phone_pro").val().trim(),new_contact_email:o.find("#new_contact_email").val().trim()},n.prop("disabled",!0),r=c.location.href.split("?")[0],$.ajax({url:r,type:"POST",data:e,dataType:"json",success:function(e){var n;e&&e.success?(n=new Option(e.contact_label,e.contact_id,!0,!0),t.append(n).trigger("change"),o.slideUp(),o.find("input").val(""),void 0!==window.saturne&&window.saturne.notification&&window.saturne.notification.success("Contact créé avec succès")):(n=e&&e.error?e.error:"Erreur lors de la création du contact",void 0!==window.saturne&&window.saturne.notification&&window.saturne.notification.error(n))},error:function(e,n,o){console.error("AJAX Error:",e,n,o);var t,n="Erreur lors de la création du contact";try{e.responseText&&(t=JSON.parse(e.responseText)).error&&(n=t.error)}catch(e){console.error("Error parsing response:",e)}void 0!==window.saturne&&window.saturne.notification&&window.saturne.notification.error(n)},complete:function(){n.prop("disabled",!1)}})):void 0!==window.saturne&&window.saturne.notification&&window.saturne.notification.error("Veuillez sélectionner un tiers"):void 0!==window.saturne&&window.saturne.notification&&window.saturne.notification.error("Le nom est obligatoire")})},window.reedcrm.eventpro.initRelaunchTooltips=function(){var a,d=null,l=!1,s=!1;$(document).on("mouseenter",".reedcrm-relaunch-button",function(){var n,e,o,t,r=$(this),i=r.data("relaunch-type"),c=r.closest(".reedcrm-relaunch-buttons").find(".reedcrm-modal-open").first().data("project-id");c&&i&&(clearTimeout(a),d&&(d.remove(),d=null),s=!(l=!1),n={call:"AC_TEL",email:"AC_EMAIL",rdv:"AC_RDV",other:"AC_OTH"}[i]||"AC_OTH",t='<div class="reedcrm-relaunch-tooltip">',t=(t='<div class="reedcrm-relaunch-tooltip"><div class="reedcrm-relaunch-tooltip-header"><strong>'+({call:"Appels",email:"Emails",rdv:"RDV",other:"Autres"}[i]||i)+'</strong></div><div class="reedcrm-relaunch-tooltip-content">')+'<div class="reedcrm-relaunch-tooltip-loading">'+(void 0!==window.saturne&&window.saturne.loader?"":"Chargement...")+"</div></div></div>",(d=$(t)).css({position:"absolute",zIndex:1e4,display:"none"}),$("body").append(d),i=r.offset(),t=r.outerHeight(),d.css({visibility:"hidden",display:"block"}),r=d.outerWidth(),e=d.outerHeight(),d.css({visibility:"visible",display:"none"}),o=i.left,t=i.top+t+5,(o=o+r>$(window).width()?$(window).width()-r-10:o)<10&&(o=10),t+e>$(window).height()&&(t=i.top-e-5),d.css({left:o+"px",top:(t=t<10?10:t)+"px"}),a=setTimeout(function(){d.fadeIn(200);var e=window.location.href,e=new URL(e).pathname.split("/").filter(function(e){return e&&""!==e}),e=0<(e=2<=e.length?e.slice(0,-2):e).length?"/"+e.join("/"):"";$.ajax({url:e+"/custom/reedcrm/ajax/get_relaunches_list.php",type:"GET",data:{project_id:c,action_type:n,token:$("meta[name=anti-csrf-currenttoken]").attr("content")||""},dataType:"json",success:function(e){s=!1,e&&e.success&&e.html?d.find(".reedcrm-relaunch-tooltip-content").html(e.html):(e=e&&e.error?e.error:"Erreur lors du chargement",d.find(".reedcrm-relaunch-tooltip-content").html('<div class="reedcrm-relaunch-tooltip-empty">'+e+"</div>"))},error:function(e,n,o){s=!1;var t="Erreur lors du chargement";e.responseJSON&&e.responseJSON.error?t=e.responseJSON.error:0===e.status?t="Erreur de connexion":404===e.status?t="Fichier non trouvé":500===e.status&&(t="Erreur serveur"),d.find(".reedcrm-relaunch-tooltip-content").html('<div class="reedcrm-relaunch-tooltip-empty">'+t+"</div>"),console.error("AJAX Error:",n,o,e)}})},300),d.on("mouseenter",function(){l=!0,clearTimeout(a)}),d.on("mouseleave",function(){l=!1,s||d.fadeOut(150,function(){$(this).remove(),d=null})}))}),$(document).on("mouseleave",".reedcrm-relaunch-button",function(){clearTimeout(a),!d||l||s||d.fadeOut(150,function(){$(this).remove(),d=null})})},window.reedcrm.quickcreation={},window.reedcrm.quickcreation.latitude=null,window.reedcrm.quickcreation.longitude=null,window.reedcrm.quickcreation.init=function(){window.reedcrm.quickcreation.event()},window.reedcrm.quickcreation.event=function(){$(document).on("change","#upload-image",window.saturne.media.uploadImage),$(document).on("click",".image-validate",window.reedcrm.quickcreation.createImg),window.reedcrm.quickcreation.getCurrentPosition(),$(document).on("submit",".quickcreation-form",window.reedcrm.quickcreation.vibratePhone),$(document).on("input","#opp_percent",window.reedcrm.quickcreation.showOppPercentValue)},window.reedcrm.quickcreation.createImg=function(){var e=$(this).closest(".wpeo-modal").find("canvas")[0].toDataURL("image/jpeg"),n=window.saturne.toolbox.getToken(),o=window.saturne.toolbox.getQuerySeparator(document.URL),o=document.URL+o+"action=add_img&token="+n;$.ajax({url:o,type:"POST",processData:!1,contentType:"application/octet-stream",data:JSON.stringify({img:e}),success:function(e){$(".wpeo-modal").removeClass("modal-active"),$("#id-container .linked-medias-list").replaceWith($(e).find("#id-container .linked-medias-list"))},error:function(){}})},window.reedcrm.quickcreation.getCurrentPosition=function(){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(e){window.reedcrm.quickcreation.latitude=e.coords.latitude,window.reedcrm.quickcreation.longitude=e.coords.longitude,$("#id-container #latitude").val(window.reedcrm.quickcreation.latitude),$("#id-container #longitude").val(window.reedcrm.quickcreation.longitude)},function(e){switch(e.code){case e.PERMISSION_DENIED:$("#id-container #geolocation-error").val("User denied the request for geolocation.");break;case e.POSITION_UNAVAILABLE:$("#id-container #geolocation-error").val("Location information is unavailable.");break;case e.TIMEOUT:$("#id-container #geolocation-error").val("The request to get user location timed out.");break;case e.UNKNOWN_ERROR:$("#id-container #geolocation-error").val("An unknown error occurred.")}}):$("#id-container #geolocation-error").val("Geolocation is not supported by this browser.")},window.reedcrm.quickcreation.vibratePhone=function(){"vibrate"in navigator&&navigator.vibrate([1e3,500,200,200,500,1e3]),window.saturne.loader.display($(".page-footer button"))},window.reedcrm.quickcreation.showOppPercentValue=function(){$(".opp_percent-value").text($("#opp_percent").val()+" %")},window.reedcrm.quickevent={},window.reedcrm.quickevent.init=function(){window.reedcrm.quickevent.event()},window.reedcrm.quickevent.event=function(){$(document).on("keyup","#label",window.reedcrm.quickevent.labelKeyUp)},window.reedcrm.quickevent.labelKeyUp=function(){$("#label").val().length>=.7*parseInt($("#label").attr("maxlength"))?$(".quickevent-label-warning-notice").removeClass("hidden"):$(".quickevent-label-warning-notice").addClass("hidden")};